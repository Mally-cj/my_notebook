## 数值积分





### 实验目的与要求

1. 进一步理解和掌握复化阶梯公式和复化辛普森公式计算定积分的理论。

2. ‘完成对复化梯形公式和复化辛普森公式的程序设计。

3. 比较两种算法精度的不同。

   



### 实验内容

$$
计算I=\int_0^1\frac{1}{1+x^2}dx
$$



计算结果为
$$
\int_0^1 \frac{dx}{1+x^2}=arctan(1)-arctan(0)=0.785398
$$


### 复化梯形公式

##### 理论

$$
I_n=\frac{h}{2}[f(a)+2\sum_{i=1}^{n-1}f(x_i)+f(b)]
$$





##### 代码

```c++
float f(float a)
{
    return 1.0/(1+a*a);
}
float y[1000];
float  trapezoid(int a,int b,int n) {
    //计算插值节点
    double h = (b - a)*1.0 / n, x = a;
    for (int i = 0; i <= n; ++i) {
        y[i] = f(x);
        x += h;
    }
    //计算定积分
    float I = f(a) + f(b);
    for (int i = 1; i < n; ++i) {
        I += 2 * y[i];
    }
    cout<<"I="<<I<<endl;
    I*=h/2;
    cout<<"I="<<I<<endl;

    printf("你好");
    printf("使用复化矩形公式，区间取[%d,%d],间隔数取%d,积分结果为%lf", a, b, n,I);
    return I;
}
```



### 辛普森Simpson积分公式

##### 理论

$$
I_n=\frac{h}{6}[f(a)+4\sum_{j=0}^{n-1}f(x_{j+0.5})+2\sum_{j=1}^{n-1}f(x_j)+f(b)]
$$

##### 代码


```c++
float simpson(int a,int b,int n)
{
    float y[2000];
    float x[2000];
    float h = (b - a)*1.0 / n;
    x[2*n]=b;
    for(int i=0;i<n;++i)
    {
      x[2*i]=a+i*h;
      y[i*2]=f(x[i*2]);
      x[2*i+1]=a+(i+0.5)*h;
      y[2*i+1]=f(x[2*i+1]);
    }
    float I=f(a)+f(b);
    for(int i=0;i<n;++i)I+=4*y[2*i+1];
    for(int i=1;i<n;++i)I+=2*y[2*i];
    I*=h/6;
    printf("使用复化辛普森公式，区间取[%d,%d],间隔数取%d,积分结果为%lf\n", a, b, n,I);
}
```



### 整体代码

```c++
#include "cstdio"
#include "cmath"
using namespace std;
float f(float a)
{
    return 1.0/(1+a*a);
}
float  trapezoid(int a,int b,int n, double r) {
    float y[1000];
    //计算插值节点
    double h = (b - a)*1.0 / n, x = a;
    for (int i = 0; i <= n; ++i) {
        y[i] = f(x);
        x += h;
    }
    //计算定积分
    float I = f(a) + f(b);
    for (int i = 1; i < n; ++i) {
        I += 2 * y[i];
    }
    I*=h/2;

    printf("使用复化矩形公式，区间取[%d,%d],间隔数取%d,得结果为%lf,与计算积分值的差值为%f\n", a, b, n,I,abs(r-I));
    return I;
}
float simpson(int a,int b,int n, double r)
{
    float y[2000];
    float x[2000];
    float h = (b - a)*1.0 / n;
    x[2*n]=b;
    for(int i=0;i<n;++i)
    {
      x[2*i]=a+i*h;
      y[i*2]=f(x[i*2]);
      x[2*i+1]=a+(i+0.5)*h;
      y[2*i+1]=f(x[2*i+1]);
    }
    float I=f(a)+f(b);
    for(int i=0;i<n;++i)I+=4*y[2*i+1];
    for(int i=1;i<n;++i)I+=2*y[2*i];
    I*=h/6;
    printf("使用复化辛普森公式，区间取[%d,%d],间隔数取%d,得结果为%lf，与计算积分值为%f\n", a, b, n,I,fabs(r-I));

}
int main()
{
    //
    float  ans=atan(1)-atan(0);
    printf("计算结果arctan(1)-arctan(0)=%lf\n",ans);
    int a=0,b=1,n=5;
    trapezoid(a,b,n,ans);
    simpson(a,b,n,ans);
    puts("---------------------------------------------------------------");
    for(n=1;n<=15;++n)
    {
    trapezoid(a,b,n,ans);
    simpson(a,b,n,ans);
    puts("");
    }
    return  0;
}
```



### 两种算法比较

1.当n不断增大时，可见两种算法的误差在减小，而使用辛普森积分公式误差降低的较快

```
计算结果arctan(1)-arctan(0)=0.785398
使用复化矩形公式，区间取[0,1],间隔数取5,得结果为0.783732,与计算积分值的差值为0.001667
使用复化辛普森公式，区间取[0,1],间隔数取5,得结果为0.785398，与计算积分值为0.000000
---------------------------------------------------------------
使用复化矩形公式，区间取[0,1],间隔数取1,得结果为0.750000,与计算积分值的差值为0.035398
使用复化辛普森公式，区间取[0,1],间隔数取1,得结果为0.783333，与计算积分值为0.002065

使用复化矩形公式，区间取[0,1],间隔数取2,得结果为0.775000,与计算积分值的差值为0.010398
使用复化辛普森公式，区间取[0,1],间隔数取2,得结果为0.785392，与计算积分值为0.000006

使用复化矩形公式，区间取[0,1],间隔数取3,得结果为0.780769,与计算积分值的差值为0.004629
使用复化辛普森公式，区间取[0,1],间隔数取3,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取4,得结果为0.782794,与计算积分值的差值为0.002604
使用复化辛普森公式，区间取[0,1],间隔数取4,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取5,得结果为0.783732,与计算积分值的差值为0.001667
使用复化辛普森公式，区间取[0,1],间隔数取5,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取6,得结果为0.784241,与计算积分值的差值为0.001157
使用复化辛普森公式，区间取[0,1],间隔数取6,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取7,得结果为0.784548,与计算积分值的差值为0.000850
使用复化辛普森公式，区间取[0,1],间隔数取7,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取8,得结果为0.784747,与计算积分值的差值为0.000651
使用复化辛普森公式，区间取[0,1],间隔数取8,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取9,得结果为0.784884,与计算积分值的差值为0.000514
使用复化辛普森公式，区间取[0,1],间隔数取9,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取10,得结果为0.784981,与计算积分值的差值为0.000417
使用复化辛普森公式，区间取[0,1],间隔数取10,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取11,得结果为0.785054,与计算积分值的差值为0.000344
使用复化辛普森公式，区间取[0,1],间隔数取11,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取12,得结果为0.785109,与计算积分值的差值为0.000289
使用复化辛普森公式，区间取[0,1],间隔数取12,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取13,得结果为0.785152,与计算积分值的差值为0.000247
使用复化辛普森公式，区间取[0,1],间隔数取13,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取14,得结果为0.785186,与计算积分值的差值为0.000213
使用复化辛普森公式，区间取[0,1],间隔数取14,得结果为0.785398，与计算积分值为0.000000

使用复化矩形公式，区间取[0,1],间隔数取15,得结果为0.785213,与计算积分值的差值为0.000185
使用复化辛普森公式，区间取[0,1],间隔数取15,得结果为0.785398，与计算积分值为0.000000
```

