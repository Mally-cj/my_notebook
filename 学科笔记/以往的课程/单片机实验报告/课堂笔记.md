第6章

### STC单片机时钟

1. 时钟源的选择

   * 外部时钟：

     由XTAL1、XTAL2引脚外接石英晶体和微调电容产生时钟信号，时钟信号的频率取决于晶振的频率，电容器的作用是稳定频率和快速起振。
   * 内部RC振荡器时钟
   
     （一般外部的晶振比较精确，而内部的成本低）

2. 可编程时钟分频器

   时钟源信号记为$f_{osc}$,	系统时钟记为$f_{SYS}$ ,N为分频系数
   $$
   f_{SYS}=f_{OSC}/N
   $$
   ![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200608/121449333.png)

### STC单片机复位



![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200608/121754898.png)

STC15系列单片机提供了7种复位方式，包括：
外部RST引脚复位
软件复位
掉电复位/上电复位
看门狗复位
内部低压检测复位
MAX810专用复位电路复位
程序地址非法复位。



### STC单片机电源模式

STC15系列单片机提供了三种运行模式，以降低系统功耗，即：
低速模式、空闲模式和掉电模式。
典型地，对于STC15系列单片机来说：
正常工作模式下，功耗为2.7mA~7mA；
空闲模式下，功耗为1.8mA；
掉电模式下，功耗为0.1μA。

1. 低速模式

   低速模式由时钟分频器CLK_DIV控制。
   通过对主时钟分频从而降低单片机工作时钟频率，降低功耗以及EMI

2. 空闲模式

   * 将IDL/PCON.0位置1，单片机将进入IDLE（空闲）模式。

   * 在空闲模式下，仅CPU无时钟，但是外部中断、内部低压检测电路、定时器、ADC转换器等仍正常工作。

   * 数据RAM、堆栈指针SP、程序计数器PC、程序状态字PSW、累加器A等寄存器都保持原有的数据。而外设的IO口电平保持不变

     

3. 掉电模式
   * 内部掉电唤醒定时器是一个15位的定时器，由特殊功能寄存器地址为0xAA的WKTCL寄存器，以及地址为0xAB的WKTCH寄存器进行管理和控制。
   * 内部掉电唤醒专用定时器计数时间由下面公式确定：
                    [106μS/掉电唤醒专用定时器时钟频率]×16×计数次数
     例如：如果定时器时钟频率为32768Hz，则内部掉电唤醒专用定时器最短计数（计数一次）的时间为：
                    [106μS/32768] ×16×1=488.28 μS

### 第7章 定时器

1. 定时器/计数器的工作原理

   定时器/计数器核心部件就是一个做加法运算的计数器，其本质就是对脉冲进行计数。根据信号源的不同分别叫做定时器和计数器。

   <img src="http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200608/183749734.png" alt="mark" style="zoom:50%;" />

2. 计算公式

   * 定时时间t=（计数器的最大空间-计数初值）*计数周期= $(2^n-a)\times 12f_{sys}(\mu s)$ 或$(2^n-a)\times f_{sys}(\mu s)$

   * 计数器的次数N=计数器的最大空间-计数初值=$2^n-a$

     （由于检测一个下降沿需要2个机器周期，即24个振动周期$\rightarrow$ 最高计数频率 $\frac{1}{24}f_{sys}$ ,$f_{sys}=12MHz$ 时，外部脉冲的最大允许频率为0.5MHz）

3. 定时器/计数器工作模式

   定时器/计数器0有4种工作模式：

   * 模式0（16位自动重新加载模式）；
     模式1（16位不可重加载模式）；
     模式2（8位自动重加载模式）；
     模式3（不可屏蔽中断的16位自动重加载模式）。

   * 定时器/计数器1工作模式有模式0、1、2。
   * 时器/计数器2、3、4的工作模式固定为模式0

### 第8章 串行通信

并行通信

* 将数据的各位用多条数据线同时进行传输。
   优点：传输速度相对较快；缺点：占用引脚多、成本高。

串行通信
  将数据分成一位一位的形式在一条线上逐个的传送。
  优点：占用引脚少、成本低；缺点：传输速度相对较慢。





```
void UartInit(void)		//9600bps@11.0592MHz
{
	SCON = 0x50;		//8位数据,可变波特率
	AUXR |= 0x40;		//定时器1时钟为Fosc,即1T
	AUXR &= 0xFE;		//串口1选择定时器1为波特率发生器
	TMOD &= 0x0F;		//设定定时器1为16位自动重装方式
	TL1 = 0xE0;		//设定定时初值
	TH1 = 0xFE;		//设定定时初值
	ET1 = 0;		//禁止定时器1中断，因为定时器1要作为一个波特率发生器，不断发信号给串口1.
	TR1 = 1;		//启动定时器1
}

```

