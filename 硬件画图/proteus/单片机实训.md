# 单片机实训

## 小记

大二sdkd学生，把博客当记录生活的日志写，嘿嘿，分享的同时也希望可以帮到一些人~

day 1 :happy: 熟悉proteus的使用；三人表决器



### day 1  熟悉Proteus使用

**感受:**老师讲的超级详细，才发现原来proteus可以用的这么流畅，老师的笔记在网盘里

**收获：**

1.  终端模式下的电源端子![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200615/155759237.png) 默认5v，如果想要修改，在配电网处修改

2. 结点模式 就是把两条线连在一起

   ![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200615/161345599.png)

3. 激励源模式下中可以输入正弦，余弦等等

**作业 ：三人表决器**

题目：3个评委，有2人及以上同意则通过，如果有1人及以下同意则不通过；使用门电路完成。

我的作业：

![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200616/180543096.png)

遇到的困难点：我不知道如何去表示逻辑0和1，我原本画的电路图存在高阻态的问题，而proteus好像默认高阻态就是高电平，后来问同学，他们是采用了用输入时钟信号的方式，来确定逻辑值。

<img src="http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200616/181039206.png" alt="mark" style="zoom:50%;" />

​													（看看，这是我挫败的作品，也许以后我就会知道我这硬件小白是有多不白了）

**老师的答案:**

推导方式：

通过的情况为A'BC+AB'C+ABC'+ABC,
利用逻辑表达式X+X=X，X+X'=1
则A'BC+AB'C+ABC'+ABC
	=A'BC+AB'C+ABC'+ABC+ABC+ABC
	=(A'+A)BC+A(B'+B)C+AB(C'+C)
	=BC+AC+AB

![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200616/174931213.png)

### day2

**感受：**今天老师讲的正是以前困惑的，而且第一次见识了物理层是如何通过电压来传递信号。

**重点内容：**keil使用printf；制作定时器延时器。

**收获：**

1. 51单片机内存分为3个区域，有时候定义变量不够用，就要用XDATA 区域。（大一参加校电赛的时候 就是遇到了这个问题）

<img src="http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200616/182528080.png" alt="mark" style="zoom: 60%;" />

2. <stc15.h>会比<reg51.h>更丰富，可以用stc-isp获得stc的头文件
3. 

```
#ifndef _UART_H  //如果说没有定义过这个宏，就按以下定义,这样防止了头文件重复
#define _UART_H
#include"stc15.h"
#endif
```

```
void SendData(unsigned char dat)
{
SBUF=dat;
while(TI!=1);//等待数据发送成功
TI=0;//清除标志位
}
```

4.重写printf,由于printf是由putchar组成

要注意虚拟终端的波特率和单片机的频率要和代码里规定的一样，否则输出会出错。

![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200616/204411736.png)

```
/*printf函数重定向*/
char putchar(char c)
{
 
}
```

5.软件延时不能精确，故而用定时器

```c
/* 定义定时器0的中断服务函数 */
void Timer0_IRQHandler() interrupt 1 using 1
{
	TF0 = 0;
	delaynum++;
}

/* ms级的延时函数 */
void Delaynms(unsigned int time)
{
	delaynum = 0;
	TR0 = 1;				//开启定时器
	while(delaynum <= time);//等待延时时间结束
	TR0 = 0;				//关闭定时器
}

```

6.为什么电路要这么接，因为手册规定了

（

![image-20200616202417897](C:%5CUsers%5C53055%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616202417897.png)

7. 使用连接PWM外设的IO口时，要先进行IO口初始化，否则IO口不能正常进行输入输出

8. MCU和DHT11的通讯过程

   （1）MCU向DHT11发送起始信号：MCU对DATA执行写操作

   （2）DHT11返回响应信号：			 MCU对DATA执行读操作

   （3）DHT11返回温湿度数据：		 MCU对DATA执行读操作

   DHT11通过DATA线拉高的时间长度表示0或1

9. 微秒级的定时器延时会有误差，因此只用软件延迟就行

   作业1：

   ​	使用BUTTON与LED元器件，实现按键按下LED灯亮，按键松开LED灯灭。

   作业2：使用定时器1，在中断服务函数中实现每隔1s钟输出温湿度的值

   作业3：使用BUTTON元器件，实现每按下按键输出一次温湿度的值。松开按键不输出。
   
   难点：如何使得按下按键，只打印一次。
   
   比如错误的代码
   
   ```
   while (1) {	
   		if(button==1)
   		{
   	DHT11_Read_Data(&Tem,&Hum);
   		printf("Tem = %d,Hum = %d\r\n",(int)Tem,(int)Hum);
   		delay();
   		}
   	}
   ```
   
   解决方法<一>定义一个变量press_flag,表示这个按键是否已经被按下
   
   解决方法<二>，定义old_statue和new_statue,知按键状态是否改变
   
   

### day3 LCD屏显示

感受：第一次接触LCD显示，点阵真好玩

收获：

1. 显示屏基本内容
   （1）显存：显存就是显卡内存，也被叫做帧缓存，它是一块特殊的内存，显示控制器会根据显存中的数据来进行图像显示，所以我们需要将显示数据写入到LCD屏模块中的显存去。

   （2）0表示某个相素点的亮，1则反之。
2. 总线模式
   电缆里面有很多条线，总线就可以理解为像电缆一样的电线	

3. 防是有PWM功能的IO口，都默认不能进行正常的输入输出操作

4. 使用软件生成点阵

   ![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200617/230140446.png)

5.code关键字的作用，直接将变量数据写入FLASH中，并且变量数据不允许改变。



作业：

1. 基础作业
   	在LCD屏上显示自己的学校、班级、姓名、学号。

   ![mark](http://mally.oss-cn-qingdao.aliyuncs.com/PicGo上传的图片/20200618/000600880.png)

2. 提高作业
   	在LCD屏上实时显示当前的温湿度值。

   难点在于字符串转换

   	妙解，使用sprintf
   	
   	
   	
   	
   	
3. 扩展作业
   单片机运行时，默认LCD屏只显示个人信息，按下按键，LCD只显示当前温湿度值，再按下按键切换到只显示个人信息。

   难点就是今天讲的按键问题了

day 4 电机

1. 单片机IO的带负栽能力较弱
2. 